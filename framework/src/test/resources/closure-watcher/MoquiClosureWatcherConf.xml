<?xml version="1.0" encoding="UTF-8" ?>
<!-- No copyright or license for configuration file, details here are not considered a creative work. -->

<!-- NOTE: for default settings, examples, and comments see the MoquiDefaultConf.xml file at
    https://github.com/moqui/moqui-framework/blob/master/framework/src/main/resources/MoquiDefaultConf.xml -->
<moqui-conf xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="http://moqui.org/xsd/moqui-conf-2.1.xsd">

    <default-property name="instance_purpose" value="dev"/>

    <!--Datasources setup -->
    <default-property name="entity_ds_db_conf" value="h2"/>
    <default-property name="entity_ds_host" value="127.0.0.1"/>
    <default-property name="entity_ds_port" value=""/>
    <default-property name="entity_ds_database" value="moqui"/>
    <default-property name="entity_ds_db_closure" value="closure_db"/>
    <default-property name="entity_ds_url" value="jdbc:h2:${moqui_runtime}/db/h2/${entity_ds_database};lock_timeout=30000"/>
    <default-property name="entity_ds_closure_url" value="jdbc:h2:${moqui_runtime}/db/h2/${entity_ds_db_closure};lock_timeout=30000"/>
    <default-property name="entity_ds_schema" value=""/>
    <default-property name="entity_ds_user" value="sa"/>
    <default-property name="entity_ds_password" value="sa"/>
    <default-property name="entity_ds_crypt_pass" value="MoquiDefaultPassword:CHANGEME"/>
    <default-property name="entity_ds_crypt_pass_old" value="MoquiDefaultPassword:CHANGEME"/>
    <default-property name="entity_add_missing_runtime" value="false"/>
    <default-property name="entity_add_missing_startup" value="true"/>

    <!-- Turn off ES by default -->
    <default-property name="elasticsearch_url" value=""/>
    <default-property name="elasticsearch_user" value=""/>
    <default-property name="elasticsearch_password" value=""/>
    <default-property name="elasticsearch_index_prefix" value=""/>
    <default-property name="elasticsearch_index_prefix" value=""/>
    <default-property name="entity_add_missing_runtime" value="true"/>

    <default-property name="supervised_closures" value="imported-project-budget-v3,workrecords-detailed,imported-project-budget-v2"/>
    <default-property name="closures_config_dir" value="component://moqui-projects-api/src/test/resources/closure/configs"/>

    <tools>
        <tool-factory class="dtq.closure.ClosureWatcherToolFactory" init-priority="100" disabled="false"/>
    </tools>

    <server-stats stats-skip-condition="pathInfo?.startsWith('/rpc') || pathInfo?.startsWith('/rest') || pathInfo?.startsWith('/status')"/>

    <!-- NOTE: using the environment variable is relatively secure in a container environment, but for more security set it here instead -->
    <entity-facade default-group-name="transactional" entity-eca-enabled="true" sequenced-id-prefix=""
                   distributed-cache-invalidate="false" dci-topic-factory="HazelcastDciTopic"
                   crypt-iter="10" crypt-algo="PBEWithMD5AndDES" crypt-pass="MoquiDefaultPassword:CHANGEME">

        <!-- let's add two databases here, one for backend, one for data -->
        <datasource
                group-name="transactional"
                database-conf-name="${entity_ds_db_conf}"
                schema-name="${entity_ds_schema}"
                runtime-add-missing="${entity_add_missing_runtime}"
                startup-add-missing="${entity_add_missing_startup}">
            <inline-jdbc pool-minsize="5" pool-maxsize="50">
                <xa-properties
                    url="${entity_ds_url}"
                    user="${entity_ds_user}"
                    password="${entity_ds_password}"/>
            </inline-jdbc>
        </datasource>

        <datasource group-name="data_storage"
                    database-conf-name="${entity_ds_db_conf}"
                    schema-name="${entity_ds_schema}"
                    runtime-add-missing="${entity_add_missing_runtime}"
                    startup-add-missing="${entity_add_missing_startup}">
            <inline-jdbc pool-minsize="5" pool-maxsize="50">
                <xa-properties
                        url="${entity_ds_closure_url}"
                        user="${entity_ds_user}"
                        password="${entity_ds_password}"/>
            </inline-jdbc>
        </datasource>

        <!-- Closure entities - definition -->
        <load-entity location="classpath://entity/ClosureEntities.xml"/>
        <!-- Closure entities - change location of closure ntt - in a separate datasource -->
        <load-entity location="component://moqui-customer/entity/ClosureExtension.xml"/>
    </entity-facade>
</moqui-conf>
